<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Study Track - 스터디 시작하기</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>

<body class="bg-light">

<!-- HEADER -->
<nav class="navbar navbar-light bg-white shadow-sm">
    <div class="container">
        <!-- ✅ 요청한 로고 형태 적용 -->
        <a href="/" class="navbar-brand fw-bold text-primary">📖 Study Track</a>

        <div class="d-flex align-items-center gap-2">
      <span class="small text-muted" th:if="${user != null}">
        <span th:text="${user.name}">사용자</span> 님
      </span>
            <a href="/logout" class="btn btn-outline-danger btn-sm" th:if="${user != null}">로그아웃</a>
            <a href="/login" class="btn btn-outline-primary btn-sm" th:if="${user == null}">로그인</a>
        </div>
    </div>
</nav>

<div class="container py-4">

    <!-- PAGE HEADER -->
    <div class="bg-white p-4 rounded shadow-sm mb-4">
        <h3 class="fw-bold mb-1">스터디 시작하기</h3>
        <p class="text-muted mb-0">
            공개 스터디에 참여하거나, 초대 코드를 입력해 비공개 스터디에 참여할 수 있어요.
        </p>
    </div>

    <!-- TABS -->
    <ul class="nav nav-tabs mb-3" role="tablist">
        <li class="nav-item" role="presentation">
            <button class="nav-link active" id="tab-public" data-bs-toggle="tab" data-bs-target="#panel-public"
                    type="button" role="tab" aria-controls="panel-public" aria-selected="true">
                🌍 공개 스터디 참여
            </button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="tab-invite" data-bs-toggle="tab" data-bs-target="#panel-invite"
                    type="button" role="tab" aria-controls="panel-invite" aria-selected="false">
                🔑 초대 코드로 참여
            </button>
        </li>
    </ul>

    <div class="tab-content">

        <!-- =========================
             PUBLIC STUDIES PANEL
             ========================= -->
        <div class="tab-pane fade show active" id="panel-public" role="tabpanel" aria-labelledby="tab-public">

            <!-- FILTER BAR -->
            <div class="bg-white p-3 rounded shadow-sm mb-3">
                <form th:action="@{/study/start}" method="get" class="row g-2 align-items-center">
                    <div class="col-md-6">
                        <input type="text" class="form-control" name="q"
                               placeholder="스터디 검색 (제목/설명)" th:value="${q}">
                    </div>
                    <div class="col-md-3">
                        <select class="form-select" name="category">
                            <option value="" th:selected="${category == null || category == ''}">전체 카테고리</option>
                            <option value="CS" th:selected="${category == 'CS'}">CS</option>
                            <option value="ALGO" th:selected="${category == 'ALGO'}">알고리즘</option>
                            <option value="BACK" th:selected="${category == 'BACK'}">백엔드</option>
                            <option value="FRONT" th:selected="${category == 'FRONT'}">프론트엔드</option>
                            <option value="LANG" th:selected="${category == 'LANG'}">외국어</option>
                            <option value="ETC" th:selected="${category == 'ETC'}">기타</option>
                        </select>
                    </div>
                    <div class="col-md-3 d-grid">
                        <button class="btn btn-outline-primary" type="submit">검색</button>
                    </div>
                </form>
            </div>

            <!-- PUBLIC STUDY LIST -->
            <div class="bg-white rounded shadow-sm">
                <div class="p-3 border-bottom d-flex justify-content-between align-items-center">
                    <div class="fw-bold">공개 스터디 목록</div>
                    <div class="text-muted small">
                        총 <span th:text="${totalPublicCount}">0</span>개
                    </div>
                </div>

                <div class="list-group list-group-flush">

                    <!-- item -->
                    <div class="list-group-item" th:each="s : ${publicStudies}">
                        <div class="d-flex justify-content-between align-items-start gap-3">
                            <div class="flex-grow-1">
                                <div class="d-flex align-items-center gap-2">
                                    <div class="fw-semibold fs-6" th:text="${s.title}">알고리즘 스터디</div>
                                    <span class="badge bg-primary" th:text="${s.category}">ALGO</span>
                                    <span class="badge bg-light text-dark">
                    👥 <span th:text="${s.memberCount}">3</span>/<span th:text="${s.capacity}">8</span>
                  </span>
                                </div>

                                <div class="text-muted small mt-1" th:text="${s.description}">
                                    매주 문제 풀이 + 코드 리뷰
                                </div>

                                <div class="text-muted small mt-1">
                                    운영자: <span class="fw-semibold" th:text="${s.ownerName}">홍길동</span>
                                    <span class="mx-2">•</span>
                                    참여 방식:
                                    <span class="badge bg-secondary" th:text="${s.joinPolicy}">REQUEST</span>
                                </div>
                            </div>

                            <div class="text-end" style="min-width: 160px;">
                                <!-- join button -->
                                <form th:action="@{/study/{id}/join(id=${s.id})}" method="post" class="m-0">
                                    <button class="btn btn-primary w-100"
                                            type="submit"
                                            th:disabled="${s.full}">
                                        참여하기
                                    </button>
                                </form>

                                <a class="btn btn-outline-secondary btn-sm w-100 mt-2"
                                   th:href="@{/study/{id}(id=${s.id})}">
                                    상세 보기
                                </a>

                                <div class="text-muted small mt-2" th:if="${s.full}">
                                    정원이 가득 찼어요.
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- empty -->
                    <div class="list-group-item text-muted small"
                         th:if="${publicStudies == null || publicStudies.isEmpty()}">
                        조건에 맞는 공개 스터디가 없어요.
                    </div>
                </div>
            </div>

            <!-- pagination (선택) -->
            <div class="d-flex justify-content-center mt-3" th:if="${page != null}">
                <nav>
                    <ul class="pagination pagination-sm">
                        <li class="page-item" th:classappend="${page.first} ? 'disabled'">
                            <a class="page-link"
                               th:href="@{/study/start(page=${page.number-1}, q=${q}, category=${category})}">이전</a>
                        </li>
                        <li class="page-item disabled">
              <span class="page-link">
                <span th:text="${page.number + 1}">1</span> / <span th:text="${page.totalPages}">1</span>
              </span>
                        </li>
                        <li class="page-item" th:classappend="${page.last} ? 'disabled'">
                            <a class="page-link"
                               th:href="@{/study/start(page=${page.number+1}, q=${q}, category=${category})}">다음</a>
                        </li>
                    </ul>
                </nav>
            </div>

        </div>

        <!-- =========================
             INVITE CODE PANEL
             ========================= -->
        <div class="tab-pane fade" id="panel-invite" role="tabpanel" aria-labelledby="tab-invite">

            <div class="row g-3">

                <!-- invite form -->
                <div class="col-md-7">
                    <div class="bg-white p-4 rounded shadow-sm">
                        <h5 class="fw-bold mb-2">초대 코드 입력</h5>
                        <p class="text-muted small mb-3">
                            운영자에게 받은 초대 코드를 입력하면 스터디에 참여할 수 있어요.
                        </p>

                        <form th:action="@{/invite/join}" method="post">
                            <div class="mb-3">
                                <label class="form-label fw-semibold">초대 코드</label>
                                <input type="text" name="code" class="form-control"
                                       placeholder="예: ABCDEF12" maxlength="32" required>
                                <div class="form-text">대소문자를 구분할 수 있어요.</div>
                            </div>

                            <!-- 선택: 닉네임/가입 메시지 -->
                            <div class="mb-3">
                                <label class="form-label fw-semibold">가입 메시지 (선택)</label>
                                <textarea name="message" class="form-control" rows="3"
                                          placeholder="간단히 자기소개나 참여 목적을 남길 수 있어요."></textarea>
                            </div>

                            <div class="d-flex justify-content-between">
                                <a href="/" class="btn btn-outline-secondary">취소</a>
                                <button type="submit" class="btn btn-primary">코드로 참여</button>
                            </div>
                        </form>

                        <!-- 서버에서 에러/성공 메시지 내려줄 때 -->
                        <div class="mt-3" th:if="${inviteError != null}">
                            <div class="alert alert-danger py-2 small mb-0" th:text="${inviteError}">
                                유효하지 않은 코드입니다.
                            </div>
                        </div>
                        <div class="mt-3" th:if="${inviteSuccess != null}">
                            <div class="alert alert-success py-2 small mb-0" th:text="${inviteSuccess}">
                                참여 요청이 완료되었습니다.
                            </div>
                        </div>
                    </div>
                </div>

                <!-- tips -->
                <div class="col-md-5">
                    <div class="bg-white p-4 rounded shadow-sm mb-3">
                        <h6 class="fw-bold mb-2">💡 참여 방식 안내</h6>
                        <ul class="small text-muted mb-0">
                            <li><b>PUBLIC</b> 스터디는 목록에서 바로 참여할 수 있어요.</li>
                            <li><b>PRIVATE</b> 스터디는 초대 링크/코드가 필요해요.</li>
                            <li>승인 필요(REQUEST) 스터디는 운영자 승인을 기다려야 해요.</li>
                        </ul>
                    </div>

                    <div class="bg-white p-4 rounded shadow-sm">
                        <h6 class="fw-bold mb-2">✅ 자주 묻는 질문</h6>
                        <div class="small text-muted">
                            <div class="mb-2">
                                <div class="fw-semibold text-dark">코드를 입력했는데 참여가 안 돼요.</div>
                                <div>코드 만료/오타/정원 초과일 수 있어요.</div>
                            </div>
                            <div>
                                <div class="fw-semibold text-dark">코드로 참여하면 바로 들어가나요?</div>
                                <div>스터디 설정이 REQUEST면 승인 후 참여돼요.</div>
                            </div>
                        </div>
                    </div>
                </div>

            </div>

        </div>

    </div>

    <footer class="text-center py-4 text-muted small">
        © 2026 Study Track
    </footer>

</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>