<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Study Track - ìŠ¤í„°ë”” ê°œì„¤</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        html { overflow-y: scroll; }
        .navbar .container {
            max-width: 1320px !important;
            padding-left: 20px !important;
            padding-right: 20px !important;
        }
    </style>
</head>
<body class="bg-light">

<nav class="navbar bg-white shadow-sm">
    <div class="container d-flex justify-content-between align-items-center">
        <a class="navbar-brand fw-bold text-primary m-0" href="/">ğŸ“– Study Track</a>
    </div>
</nav>

<section class="container py-5 text-center">
    <h2 class="fw-bold mb-2">ìŠ¤í„°ë”” ê°œì„¤</h2>
    <p class="text-muted mb-0">ìŠ¤í„°ë”” ì •ë³´ë¥¼ ì…ë ¥í•˜ê³  íŒ€ì›ì„ ëª¨ì§‘í•´ë³´ì„¸ìš”</p>
</section>

<section class="container pb-5">
    <div class="row justify-content-center">
        <div class="col-lg-8">
            <div class="card shadow-sm border-0">
                <div class="card-body p-4">
                    <form action="#" method="post">
                        <div class="mb-3">
                            <label class="form-label fw-semibold">ìŠ¤í„°ë”” ì œëª©</label>
                            <input type="text" class="form-control" placeholder="ì˜ˆ) ìŠ¤í”„ë§ ë¶€íŠ¸ ìŠ¤í„°ë””">
                        </div>
                        <div class="mb-3">
                            <label class="form-label fw-semibold">ìŠ¤í„°ë”” ì„¤ëª…</label>
                            <textarea class="form-control" rows="4" placeholder="ìŠ¤í„°ë”” ëª©í‘œ, ì§„í–‰ ë°©ì‹, ì£¼ê¸° ë“±ì„ ê°„ë‹¨íˆ ì ì–´ì£¼ì„¸ìš”"></textarea>
                        </div>
                        <div class="row g-3">
                            <div class="col-md-6">
                                <label class="form-label fw-semibold">ìµœëŒ€ ì¸ì› ìˆ˜</label>
                                <input type="number" class="form-control" min="2" max="50" value="5">
                            </div>
                            <div class="col-md-6">
                                <label class="form-label fw-semibold">ì¹´í…Œê³ ë¦¬</label>
                                <select class="form-select">
                                    <option selected disabled>ì¹´í…Œê³ ë¦¬ë¥¼ ì„ íƒí•˜ì„¸ìš”</option>
                                    <option>ì „ê³µ / CS</option>
                                    <option>ìê²©ì¦</option>
                                    <option>ì½”ë”© í…ŒìŠ¤íŠ¸</option>
                                    <option>í”„ë¡œì íŠ¸</option>
                                    <option>ì™¸êµ­ì–´</option>
                                    <option>ê¸°íƒ€</option>
                                </select>
                            </div>
                        </div>
                        <hr class="my-4">
                        <div class="mb-3">
                            <h6 class="fw-bold mb-2">ìŠ¤í„°ë””ì› ì´ˆëŒ€í•˜ê¸°</h6>
                            <div class="alert alert-primary border-0">
                                <div class="d-flex justify-content-between align-items-center flex-wrap gap-2">
                                    <div><div class="fw-semibold">ì´ˆëŒ€ ì½”ë“œ</div></div>
                                    <code class="px-3 py-2 bg-white rounded border">STUDY-1234</code>
                                </div>
                            </div>
                        </div>
                        <div class="d-flex justify-content-end gap-2 mt-4">
                            <a href="/" class="btn btn-outline-primary">ì·¨ì†Œ</a>
                            <button type="button" id="createStudyBtn" class="btn btn-primary">
                                ìŠ¤í„°ë”” ê°œì„¤
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</section>

<footer class="text-center py-4 text-muted small">Â© 2026 Study Track</footer>

<script>
    document.addEventListener("DOMContentLoaded", function() {
        const navArea = document.getElementById("navAuthArea");
        const token = localStorage.getItem("accessToken");
        const nickname = localStorage.getItem("nickname");
        const userId = localStorage.getItem("userId");
        const isExist = (val) => val && val !== "null" && val !== "undefined" && val !== "";

        if (isExist(token)) {
            const finalName = isExist(nickname) ? nickname : userId;
            navArea.innerHTML = `<span class="fw-bold me-2 text-dark">${finalName} ë‹˜</span><button class="btn btn-outline-danger btn-sm" onclick="logout()">ë¡œê·¸ì•„ì›ƒ</button>`;
        } else {
            navArea.innerHTML = `<a href="/auth/signup" class="btn btn-primary btn-sm">íšŒì›ê°€ì…</a> <a href="/auth/login" class="btn btn-outline-primary btn-sm">ë¡œê·¸ì¸</a>`;
        }
    });
    function logout() { if(confirm("ë¡œê·¸ì•„ì›ƒ í•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) { localStorage.clear(); window.location.href = "/"; } }

    <!-- studyCreate -->
    document.addEventListener("DOMContentLoaded", function () {

      const btn = document.getElementById("createStudyBtn");

      btn.addEventListener("click", async function () {

        const token = localStorage.getItem("accessToken");
        if (!token) {
          alert("ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.");
          window.location.href = "/auth/login";
          return;
        }

        // ì…ë ¥ê°’ ìˆ˜ì§‘
        const title = document.querySelector('input[type="text"]').value.trim();
        const description = document.querySelector("textarea").value.trim();
        const maxMembers = Number(document.querySelector('input[type="number"]').value);
        const categoryText = document.querySelector("select").value;

        const categoryMap = {
          "ì „ê³µ / CS": "CS",
          "ìê²©ì¦": "CERTIFICATE",
          "ì½”ë”© í…ŒìŠ¤íŠ¸": "CODING_TEST",
          "í”„ë¡œì íŠ¸": "PROJECT",
          "ì™¸êµ­ì–´": "LANGUAGE",
          "ê¸°íƒ€": "ETC"
        };

        if (!title || !description) {
          alert("ì œëª©ê³¼ ì„¤ëª…ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.");
          return;
        }

        const category = categoryMap[categoryText];
        if (!category) {
          alert("ì¹´í…Œê³ ë¦¬ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.");
          return;
        }

        const requestBody = {
          title: title,
          description: description,
          maxMembers: maxMembers,
          category: category
        };

        try {
          const response = await fetch("/api/studyCreate", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
              "Authorization": token.startsWith("Bearer ") ? token : ("Bearer " + token)
            },
            body: JSON.stringify(requestBody)
          });

          if (!response.ok) {
            const errorText = await response.text();
            alert("ìŠ¤í„°ë”” ê°œì„¤ ì‹¤íŒ¨: " + errorText);
            return;
          }

          const data = await response.json();

          alert("ìŠ¤í„°ë””ê°€ ê°œì„¤ë˜ì—ˆìŠµë‹ˆë‹¤!");

          // ğŸ‘‰ ìƒì„¸ í˜ì´ì§€ë¡œ ì´ë™
          // ì €ì¥ ì„±ê³µ í›„
<!--          window.location.href = `/study/detail?studyId=${data.studyId}`;-->
          window.location.href = `/study/${data.studyId}`;
        } catch (error) {
          console.error(error);
          alert("ì„œë²„ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
        }

      });

    });
</script>
</body>
</html>